# A2PC 在电商场景的应用

A2PC 旨在解决在分布式中的事务问题。在电商的场景中时常需要面对分布式事务的问题，而且对数据的一致性有着严格的要求，A2PC 在电商场景中能够低成本、高性能的解决分布式事务的问题。在 A2PC 实现之后，这里会以电商里的下单场景为例子介绍 A2PC 在业务中如何应用。在电商场景下，会有正向、逆向流程，其中正向流程又有很多步骤，这里只以下单为例子，在其他步骤的落地方式中一样。  

用户下单操作包括：
1. 创建订单
2. 扣除库存
3. 优惠券/积分抵扣
4. 余额扣减

这 4 个操作需要在一个事务中，全部完成或者全部失败。在数据和并发量比较大的场景下 [分库分表](/pidal/sharding) 是比较常用、也是效果不错的方案。但是分库分表之后就很难完全避免分布式事务的问题，即便根据用户纬度做拆分，创建订单优、惠券抵扣、余额扣减这三个操作可以在一个本地事务中，但是商品库存就无法保障在一个本地事务甚至在一个机器上了。而且这种拆分会随着业务的增长逐步遇到单机瓶颈。所以在电商场景中随着业务的增长，分布式事务问题难以避免。

以上只说了分库分表，伴随着业务的增长、还有「[微服务](https://zh.wikipedia.org/wiki/微服務)」架构的日渐成熟，有企业会对下单操作中涉及的各方拆分为独立的服务，比如订单、库存、资产等独立的服务，各自负责订单状态扭转、库存操作、优惠券、积分、余额的用户资产相关操作。这样一个下单操作就变成了跨服务的分布式事务操作了。而且做了服务的拆分之后，依然还有会有分库分表的场景，不过这里解决分库分表引起的问题并不需要单独拎出来解决，A2PC 在解决跨服务事务的时候会一同解决。所以这里把下单操作分为两种场景：
1. 分库分表场景下下单操作
2. 跨服务下单操作

## 分库分表下单操作
## 跨服务下单操作